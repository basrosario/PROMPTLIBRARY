# Praxis Project Handoff Document

**Last Updated:** 2026-02-06 (Session 33)
**Last Commit:** 32ec056 - fix: Close search modal when selecting a result on the same page
**Current Phase:** Framework Quality Redesign (Waves 1-3 complete, Wave 4 next) + Search/URL fixes

---

## CURRENT SESSION STATUS (Session 33)

### Completed This Session

#### 1. Critical Bug Fix: Universal URL Resolution
**Commit:** `8fda121`

All internal URLs generated by JavaScript were broken when accessed from subdirectory pages. Example: searching from `/pages/faq.html` produced links to `/pages/pages/glossary.html` (doubled path).

**Root cause:** URLs stored as root-relative paths (e.g., `pages/glossary.html`) in search-index.json and JS data were rendered directly without adjusting for current page directory depth.

**Fix:** Created `resolveInternalUrl(targetPath)` — a universal path resolver at **app.js line ~471** that:
- Counts the current page's directory depth from pathname segments
- Prepends the correct number of `../` to reach root
- Works from ANY depth (root, /pages/, /learn/, /learn/modality/code/, /foundations/, /neurodivergence/)

Applied to **10 locations** in app.js:

| Location | Line | What was broken |
|---|---|---|
| `getGlossaryUrl()` | ~487 | Neural canvas term clicks |
| Search modal results | ~8585 | All 2,218 search results |
| CONTENT_CATALOG search | ~7846 | Content library search |
| Recommender best.url | ~8079 | Framework matcher learn links |
| Recommender alt.url | ~8084 | Framework matcher alternatives |
| Technique learnUrl | ~5554 | Prompt analyzer technique links |
| Badge lightbox links | ~7048 | Badge internal links |
| `getSearchLinkPath()` | ~8382 | Search modal quick links |
| Glossary JSON fetch | ~7500 | Glossary data loading |

**Important:** `getSearchLinkPath()` now delegates to `resolveInternalUrl()`. Any future dynamic URL construction should use `resolveInternalUrl('path/to/file.html')`.

#### 2. Search Modal Enhancements
**Commits:** `0d758a9`, `32ec056`

| Change | Details |
|---|---|
| **80% screen width** | Modal: `max-width: 80vw`, `top: 5%`, `max-height: 88vh` (was 720px, 8%, 85vh) |
| **Quick Links collapsible** | Added chevron toggle, `.collapsed` class, CSS max-height transition, starts collapsed |
| **Glossary terms first** | Category order: `['Glossary', 'Learn', 'Tools', 'Patterns', 'FAQ', 'Resources']` (was Learn first) |
| **Glossary 10 results** | Glossary shows up to 10 results, other categories stay at 5 |
| **Glossary hash scroll** | After JSON lazy-load, checks `window.location.hash` and scrolls to `#term-xxx` target |
| **Modal closes on select** | Clicking or Enter-selecting any result closes modal first, then navigates |
| **Same-page hash handling** | `navigateToResult()` detects same-page anchors and scrolls directly |

**Key JS additions:**
- `searchModal.navigateToResult(href)` — handles same-page hash vs. full navigation
- Results container click listener — intercepts `<a>` clicks to close modal first
- Quick Links toggle — `#search-modal-help-toggle` with keyboard support (Enter/Space)
- Post-lazy-load hash scroll in `loadGlossaryFromJSON().then()` chain

#### 3. Wave 3 Comparison Panel Fix
**Commit:** `390715f`

Updated comparison panels in 3 Wave 3 files (decomp.html, graph-of-thought.html, recursion-of-thought.html) to use the new header/icon/divider/verdict structure. Added dark mode background for `.era-marker--active`.

---

## NEXT UP: Wave 4 — Advanced Reasoning (7 pages)

Each page must be redesigned from ~290 lines to 700-1000+ lines using the 13-section template.

**Reference template:** `learn/auto-cot.html` (855 lines, 13 sections) or `learn/critic.html` (898 lines)

| # | File | Current Lines | Target |
|---|------|--------------|--------|
| 1 | `learn/analogical-reasoning.html` | ~290 | 700-1000+ |
| 2 | `learn/meta-reasoning.html` | ~290 | 700-1000+ |
| 3 | `learn/thread-of-thought.html` | ~290 | 700-1000+ |
| 4 | `learn/memory-of-thought.html` | ~290 | 700-1000+ |
| 5 | `learn/simtom.html` | ~290 | 700-1000+ |
| 6 | `learn/max-mutual-info.html` | ~290 | 700-1000+ |
| 7 | `learn/universal-self-consistency.html` | ~290 | 700-1000+ |

### Remaining Waves

| Wave | Pages | Status |
|------|-------|--------|
| Wave 1 — Self-Correction | 6 pages | ✅ COMPLETE |
| Wave 2 — CoT Variants | 8 pages | ✅ COMPLETE |
| Wave 3 — Decomposition | 6 pages | ✅ COMPLETE |
| Wave 4 — Advanced Reasoning | 7 pages | ⬜ START HERE |
| Wave 5 — Example Methods | 7 pages (active-prompting, knn-prompting, vote-k, demo-ensembling, diverse-prompting, dense-prompting, prompt-mining) | ⬜ PENDING |
| Wave 6 — Style & Emotion | 6 pages (emotion-prompting, style-prompting, s2a, re2, cosp, rar) | ⬜ PENDING |

---

## ARCHITECTURAL NOTES

### resolveInternalUrl() — Universal Path Resolver (app.js ~471)
```javascript
function resolveInternalUrl(targetPath) {
    // Skip absolute, anchor-only, or already-resolved paths
    if (!targetPath || targetPath.startsWith('http') || targetPath.startsWith('/') ||
        targetPath.startsWith('#') || targetPath.startsWith('mailto:')) {
        return targetPath;
    }
    const pathname = window.location.pathname;
    const segments = pathname.replace(/^\//, '').split('/');
    const depth = Math.max(0, segments.length - 1); // -1 for filename
    if (depth === 0) return targetPath;
    return '../'.repeat(depth) + targetPath;
}
```
**Usage:** `resolveInternalUrl('pages/glossary.html#term-foo')` — always pass root-relative paths (no `../` prefix). The function calculates the correct prefix based on current page depth.

### Search Modal Architecture (app.js ~8394-8810)
- `createSearchModal()` — generates HTML, injected into DOM
- `searchModal.init()` — attaches all event listeners
- `searchModal.open()` / `.close()` — toggle visibility + body overflow
- `searchModal.navigateToResult(href)` — handles same-page hash vs. full navigation
- `searchPraxis(query)` — searches index, returns grouped results (Glossary first)
- `renderSearchResults(grouped, query)` — renders result HTML with highlight marks

---

## CRITICAL RULES - MUST FOLLOW

### 1. Security & CSP Compliance (A+ Rating)
- **NO inline styles** — Never use `style=""` attributes
- **NO inline scripts** — Never use `onclick=""`, `onload=""`, or inline `<script>`
- **NO external resources** — No CDNs, Google Fonts, external APIs
- **All styles → styles.css** (single file)
- **All scripts → app.js** (single file with `defer`)

### 2. Content Rules
- **NO citations on framework pages** (per user request, Session 25)
- **NO stat cards** — Use highlight-box components instead
- **NO content badges** — Removed from all learn pages (Session 29)
- **Historical context notices required** on all framework pages

### 3. Code Notation
```
HTML:  <!-- === SECTION === --> ... <!-- /SECTION -->
CSS:   /* === SECTION === */ ... /* Component ---- */
JS:    // === SECTION === ... /** JSDoc comments */
```

### 4. URL Construction
- **ALWAYS use `resolveInternalUrl()`** for any dynamically generated internal links
- Pass root-relative paths: `resolveInternalUrl('pages/glossary.html#term-foo')`
- Never hardcode `../` prefixes for dynamic links — the function handles all depths

### 5. Information Accuracy
- All historical/factual claims must be verified from .edu or .gov sources
- No fake, made up, or misleading information
- Framework dates and relevancy status must be academically verified

---

## FILE STRUCTURE

```
_public_html/
├── index.html              # Home page (updated hero)
├── styles.css              # ALL CSS (single file)
├── app.js                  # ALL JavaScript (single file)
├── foundations/
│   └── index.html          # AI Foundations timeline (5 eras + framework directories)
├── learn/                  # Framework pages (40+)
│   ├── [all framework pages]
│   └── modality/code/      # Code frameworks (3 pages)
├── data/
│   ├── glossary.json       # 2,141 AI terms (lazy loaded)
│   └── search-index.json   # 2,218 searchable entries
├── pages/
│   └── glossary.html       # Glossary page (686 lines, shells only)
└── .claude/
    ├── HANDOFF.md           # THIS FILE
    ├── COMPLETED.md         # Archive of completed work
    └── plans/
        └── FrameworkOverhaul.md   # Master plan + 40-page redesign waves
```

---

## INTERACTIVE COMPONENTS AVAILABLE

| Component | CSS Class | Use For |
|-----------|-----------|---------|
| Accordions | `.accordion-item`, `.accordion-header`, `.accordion-content` | Expandable sections |
| Comparison panels | `.comparison-panel` | Before/after, side-by-side |
| Element timelines | `.element-timeline` | Step-by-step processes |
| Feature lists | `.feature-list` | Perfect For / Skip It When |
| Pillar cards | `.pillar-card`, `.pillar-card--featured` | Card grids |
| Evolution timeline | `.evolution-timeline`, `.era-marker` | Framework positioning |
| Evolution callout | `.evolution-callout` | Related framework links |
| Use case showcase | `.use-case-showcase` | Application scenarios |
| Technique demo | `.technique-demo` | Interactive demonstrations |
| Scenario timeline | `.scenario-timeline` | Multi-step examples |
| Conversation timeline | `.conversation-timeline` | Dialogue examples |
| Highlight boxes | `.highlight-box`, `.highlight-box--warning` | Callouts, notices |
| Split sections | `.split-section` | Two-column layouts |
| History events | `.history-event`, `.history-event--landmark` | Timeline events |
| Era headers | `.era-header` | Timeline era sections |
| Era frameworks | `.era-frameworks`, `.era-frameworks__grid` | Framework directory grids |
| Framework status | `.framework-status--active`, `--adopted`, `--historical` | Relevancy badges |
| CTA corporate | `.cta-corporate` | Call to action with neural bg |

---

## REFERENCE

| Document | Purpose |
|----------|---------|
| `.claude/HANDOFF.md` | Current state (this file) |
| `.claude/COMPLETED.md` | Archived completed work |
| `.claude/plans/FrameworkOverhaul.md` | Master plan with session logs + 40-page redesign waves |
| `learn/critic.html` | Reference template for quality redesign (898 lines, 13 sections) |
| `learn/auto-cot.html` | Alternate reference template (855 lines, 13 sections) |

---

*Always read this file first when resuming work. Follow the critical rules exactly.*
